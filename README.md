local-persistency
================

[Local storage](https://developer.mozilla.org/en-US/docs/Web/Guide/API/DOM/Storage) abstraction for quick prototyping of one page apps.

### Intro ###

This library uses the **local storage browser api** to simulate database tables. 

Basic **CRUD** operations are supported.

### Table instance ###

```js
var cars = LocalPersistency.table("cars");
```

This method is idempotent, which means you can call it as much as you like and the same table intance will be returned.

### Create ###

You can create table records by doing:

```js
var autoGeneratedPrimaryKey = cars.create({
   make: "Ferrari",
   model: "458"
});

assertEqual(autoGeneratedPrimaryKey, 0);
```

### Read ###

You can read (retrieve) a record by primary key by doing:

```js
var car = cars.read(0);
assertEqual(car.model, "458");
```

### Update ###

Updates are also possible:

```js
cars.read(0, {
   make: "Fiat",
   model: "Panda"
});

var car = cars.read(0);
assertEqual(car.model, "Panda");
```

### Delete ###

And of course deletion is always an option:

```js
cars.delete(0);
var car = cars.read(0);
assertEqual(car, null);
```

### Retrieve a list of elements ###

If you need to retrieve a list of elements simply use the `slot` method. It will return an array of elements of this form:

```js
{
   pkey: 0,
   data: ...
}
```

where `pkey` is the automatically associated primary key and `data` is the actual information you persisted with the `create` or `update` method.

You can sort in (primary key) ascending manner:

```js
cars.create("a");
cars.create("b");
cars.create("c");
var recordset = cars.slot(0, 2, "asc");
assertEqual(recordset.length, 2);
assertEqual(recordset[0].pkey, 0);
assertEqual(recordset[0].data, "a");
assertEqual(recordset[1].pkey, 1);
assertEqual(recordset[1].data, "b");
```

or (primary key) descending manner:

```js
cars.create("a");
cars.create("b");
cars.create("c");
var recordset = cars.slot(0, 2, "desc");
assertEqual(recordset.length, 2);
assertEqual(recordset[0].pkey, 2);
assertEqual(recordset[0].data, "c");
assertEqual(recordset[1].pkey, 1);
assertEqual(recordset[1].data, "b");
```

### Table operations ###

#### count ####

You can count the number of records:

```js
assertEqual(cars.count(), 0);
```

#### truncate ####

You can also truncate all the records of a table in one go:

```js
cars.create({
   make: "Fiat",
   model: "500"
});
assertEqual(cars.count(), 1);
cars.truncate();
assertEqual(cars.count(), 0);
```

Remember that truncating a table **does not reset** its primary key generator!
